# ==============================================================================
# Kubernetes Secrets for ACS Application
# Note: In production, these should be created via sealed-secrets, external-secrets,
# or vault operator rather than being stored in git
# ==============================================================================

# Base Application Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: acs-secrets
  labels:
    app: acs
    component: secrets
type: Opaque
data:
  # Base64 encoded secrets (use external secret management in production)
  # jwt-secret-key: <base64-encoded-jwt-secret>
  # redis-password: <base64-encoded-redis-password>
  # smtp-username: <base64-encoded-smtp-username>
  # smtp-password: <base64-encoded-smtp-password>
  # appinsights-instrumentationkey: <base64-encoded-appinsights-key>
  # appinsights-connection-string: <base64-encoded-appinsights-connection>

---
# Tenant-specific Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: acs-secrets-TENANT_ID
  labels:
    app: acs
    component: secrets
    tenant: TENANT_ID
type: Opaque
data:
  # database-connection-string: <base64-encoded-database-connection-for-tenant>
  # encryption-master-key: <base64-encoded-encryption-key-for-tenant>
  # tenant-specific-jwt-key: <base64-encoded-tenant-jwt-key>

---
# TLS Certificates Secret
apiVersion: v1
kind: Secret
metadata:
  name: acs-tls-certs
  labels:
    app: acs
    component: certificates
type: kubernetes.io/tls
data:
  # tls.crt: <base64-encoded-certificate>
  # tls.key: <base64-encoded-private-key>

---
# Application Keys Secret Template
apiVersion: v1
kind: Secret
metadata:
  name: acs-app-keys-TENANT_ID
  labels:
    app: acs
    component: encryption-keys
    tenant: TENANT_ID
type: Opaque
data:
  # data-protection-key: <base64-encoded-data-protection-key>
  # encryption-key-ring: <base64-encoded-key-ring>

---
# External Secrets Operator Configuration (if using)
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: acs-secret-store
  labels:
    app: acs
    component: external-secrets
spec:
  provider:
    azurekv:
      # Configure Azure Key Vault provider
      vaultUrl: "${AZURE_KEY_VAULT_URI}"
      authSecretRef:
        clientId:
          name: azure-secret-sp
          key: ClientID
        clientSecret:
          name: azure-secret-sp
          key: ClientSecret
      tenantId: "${AZURE_TENANT_ID}"

---
# External Secret for JWT Secret
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: acs-jwt-secret
  labels:
    app: acs
    component: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: acs-secret-store
    kind: SecretStore
  target:
    name: acs-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        jwt-secret-key: "{{ .jwtSecretKey }}"
  data:
  - secretKey: jwtSecretKey
    remoteRef:
      key: acs-jwt-secret-key

---
# External Secret for Database Connections
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: acs-database-secrets-TENANT_ID
  labels:
    app: acs
    component: external-secrets
    tenant: TENANT_ID
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: acs-secret-store
    kind: SecretStore
  target:
    name: acs-secrets-TENANT_ID
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        database-connection-string: "{{ .databaseConnectionString }}"
        encryption-master-key: "{{ .encryptionMasterKey }}"
  data:
  - secretKey: databaseConnectionString
    remoteRef:
      key: acs-database-connection-TENANT_ID
  - secretKey: encryptionMasterKey
    remoteRef:
      key: acs-encryption-key-TENANT_ID